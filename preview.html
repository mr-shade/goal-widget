<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>StreamElements Widget Preview</title>
    <style>
        body {
            margin: 0;
            padding: 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            min-height: 100vh;
        }

        .preview-container {
            max-width: 1200px;
            margin: 0 auto;
        }

        .controls {
            background: white;
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 20px;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.2);
        }

        .controls h2 {
            margin: 0 0 15px 0;
            color: #333;
        }

        .control-group {
            margin-bottom: 15px;
        }

        .control-group label {
            display: inline-block;
            width: 150px;
            font-weight: 600;
            color: #555;
        }

        .control-group select,
        .control-group input {
            padding: 8px;
            border: 2px solid #ddd;
            border-radius: 5px;
            font-size: 14px;
        }

        .control-group button {
            padding: 10px 20px;
            background: #667eea;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-weight: 600;
            margin-right: 10px;
            transition: background 0.3s;
        }

        .control-group button:hover {
            background: #5568d3;
        }

        .widget-wrapper {
            background: rgba(0, 0, 0, 0.3);
            padding: 40px;
            border-radius: 10px;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 600px;
        }

        .instructions {
            background: #fffbea;
            border-left: 4px solid #f59e0b;
            padding: 15px;
            margin-bottom: 20px;
            border-radius: 5px;
        }

        .instructions h3 {
            margin: 0 0 10px 0;
            color: #92400e;
        }

        .instructions p {
            margin: 5px 0;
            color: #78350f;
        }
    </style>
</head>

<body>
    <div class="preview-container">
        <div class="instructions">
            <h3>ðŸŽ¨ Widget Preview Mode</h3>
            <p><strong>How to use:</strong> Use the controls below to test different styles and simulate events.</p>
            <p><strong>Note:</strong> This preview simulates the StreamElements environment locally.</p>
        </div>

        <div class="controls">
            <h2>Widget Controls</h2>

            <div class="control-group">
                <label>Widget Style:</label>
                <select id="styleSelect" onchange="updateSettings()">
                    <option value="widget1">Widget 1 (Full Circle - Text)</option>
                    <option value="widget2">Widget 2 (Full Circle - Image)</option>
                    <option value="widget3">Widget 3 (Arch)</option>
                    <option value="widget4">Widget 4 (Open Loop)</option>
                </select>
            </div>

            <div class="control-group">
                <label>Appearance:</label>
                <select id="appearanceSelect" onchange="updateSettings()">
                    <option value="solid">Solid</option>
                    <option value="gradient_neon" selected>Gradient + Neon</option>
                </select>
            </div>

            <div class="control-group">
                <label>Primary Color:</label>
                <input type="color" id="primaryColor" value="#ff2d95" onchange="updateSettings()">
            </div>

            <div class="control-group">
                <label>Secondary Color:</label>
                <input type="color" id="secondaryColor" value="#00ffd5" onchange="updateSettings()">
            </div>

            <div class="control-group">
                <label>Goal Value:</label>
                <input type="number" id="goalInput" value="100" onchange="updateSettings()">
            </div>

            <div class="control-group">
                <label>Simulate Events:</label>
                <button onclick="simulateEvent('follower')">+1 Follower</button>
                <button onclick="simulateEvent('sub')">+1 Sub</button>
                <button onclick="simulateEvent('tip')">+5 Tip</button>
                <button onclick="simulateEvent('reset')">Reset</button>
            </div>
        </div>

        <div class="widget-wrapper">
            <iframe id="widgetFrame" src="widget.html" style="border:none; background:transparent;" width="500"
                height="500">
            </iframe>
        </div>
    </div>

    <script>
        let widgetWindow;

        // Wait for iframe to load
        document.getElementById('widgetFrame').addEventListener('load', function () {
            widgetWindow = this.contentWindow;
            initializeWidget();
        });

        function initializeWidget() {
            // Simulate StreamElements API
            const mockFieldData = {
                styleMode: 'widget1',
                appearanceMode: 'gradient_neon',
                primaryColor: '#ff2d95',
                secondaryColor: '#00ffd5',
                bgTrackColor: '#5a5a5a',
                glowColor: 'rgba(255,45,149,0.8)',
                textColor: '#ffffff',
                titleText: 'SUBSCRIPTIONS',
                fontFamily: 'Poppins, sans-serif',
                titleSize: 28,
                fontSizeValue: 42,
                imageUrl: '',
                imageShape: 'none',
                goalValue: 100,
                startingProgress: 65,
                currentValue: 0,
                eventType: 'subscriber',
                progressIncrementUnit: 1,
                stopAtGoal: false,
                resetAtGoal: false,
                increaseAfterGoalBy: 0,
                enableChatCommands: true,
                enableGlow: true,
                useGradient: true,
                size: 420,
                showDebugButtons: true
            };

            // Mock SE_API
            widgetWindow.SE_API = {
                store: {
                    data: {},
                    get: function (key) {
                        return Promise.resolve(this.data[key] || null);
                    },
                    set: function (key, value) {
                        this.data[key] = value;
                        console.log('Store updated:', key, value);
                        return Promise.resolve();
                    }
                }
            };

            // Trigger widget load
            const loadEvent = new CustomEvent('onWidgetLoad', {
                detail: {
                    fieldData: mockFieldData,
                    session: { data: {} }
                }
            });
            widgetWindow.dispatchEvent(loadEvent);
        }

        function updateSettings() {
            const settings = {
                styleMode: document.getElementById('styleSelect').value,
                appearanceMode: document.getElementById('appearanceSelect').value,
                primaryColor: document.getElementById('primaryColor').value,
                secondaryColor: document.getElementById('secondaryColor').value,
                goalValue: parseInt(document.getElementById('goalInput').value)
            };

            // Reload widget with new settings
            setTimeout(() => {
                widgetWindow.location.reload();
                setTimeout(initializeWidget, 100);
            }, 50);
        }

        function simulateEvent(type) {
            if (!widgetWindow || !widgetWindow.simulateEvent) {
                console.error('Widget not loaded yet');
                return;
            }

            switch (type) {
                case 'follower':
                case 'sub':
                    widgetWindow.simulateEvent('add', 1);
                    break;
                case 'tip':
                    widgetWindow.simulateEvent('add', 5);
                    break;
                case 'reset':
                    widgetWindow.simulateEvent('reset');
                    break;
            }
        }
    </script>
</body>

</html>